function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var e=/*#__PURE__*/t(require("@unseenco/e"));function r(){return r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},r.apply(this,arguments)}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function i(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0;return function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=new DOMParser;function a(t){var e=new URL(t,window.location.origin),r=e.hash.length?t.replace(e.hash,""):null;return{hasHash:e.hash.length>0,pathname:e.pathname,host:e.host,search:e.search,raw:t,href:r||e.href}}function c(t,e){t.parentNode.replaceChild(h(t,e),t)}function s(t,e){("HEAD"===t.parentNode.tagName?document.head:document.body).appendChild(h(t,e))}function h(t,e){for(var r=document.createElement(e),n=0;n<t.attributes.length;n++){var i=t.attributes[n];r.setAttribute(i.nodeName,i.nodeValue)}return t.innerHTML&&(r.innerHTML=t.innerHTML),r}var u=/*#__PURE__*/function(){function t(t){this.wrapper=t.wrapper}var e=t.prototype;return e.leave=function(t){var e=this;return new Promise(function(n){e.onLeave(r({},t,{done:n}))})},e.enter=function(t){var e=this;return new Promise(function(n){e.onEnter(r({},t,{done:n}))})},e.onLeave=function(t){(0,t.done)()},e.onEnter=function(t){(0,t.done)()},t}(),l=/*#__PURE__*/function(){function t(t){var e=t.page,r=t.title,n=t.wrapper;this._contentString=t.content.outerHTML,this._DOM=null,this.page=e,this.title=r,this.wrapper=n,this.content=this.wrapper.lastElementChild}var e=t.prototype;return e.onEnter=function(){},e.onEnterCompleted=function(){},e.onLeave=function(){},e.onLeaveCompleted=function(){},e.initialLoad=function(){this.onEnter(),this.onEnterCompleted()},e.update=function(){document.title=this.title,this.wrapper.appendChild(this._DOM.firstElementChild),this.content=this.wrapper.lastElementChild,this._DOM=null},e.createDom=function(){this._DOM||(this._DOM=document.createElement("div"),this._DOM.innerHTML=this._contentString)},e.remove=function(){this.wrapper.firstElementChild.remove()},e.enter=function(t,e){var r=this;return new Promise(function(n){r.onEnter(),t.enter({trigger:e,to:r.content}).then(function(){r.onEnterCompleted(),n()})})},e.leave=function(t,e,r){var n=this;return new Promise(function(i){n.onLeave(),t.leave({trigger:e,from:n.content}).then(function(){r&&n.remove(),n.onLeaveCompleted(),i()})})},t}(),f=/*#__PURE__*/function(){function t(){this.data=new Map,this.regexCache=new Map}var e=t.prototype;return e.add=function(t,e,r){this.data.has(t)||(this.data.set(t,new Map),this.regexCache.set(t,new RegExp("^"+t+"$"))),this.data.get(t).set(e,r),this.regexCache.set(e,new RegExp("^"+e+"$"))},e.findMatch=function(t,e){for(var r,n=i(this.data);!(r=n()).done;){var o=r.value,a=o[1];if(t.pathname.match(this.regexCache.get(o[0]))){for(var c,s=i(a);!(c=s()).done;){var h=c.value,u=h[1];if(e.pathname.match(this.regexCache.get(h[0])))return u}break}}return null},t}(),d="A transition is currently in progress",p=/*#__PURE__*/function(){function t(t){var e=this;void 0===t&&(t={}),this.isTransitioning=!1,this.currentCacheEntry=null,this.cache=new Map,this.activePromises=new Map,this.onClick=function(t){if(!t.metaKey&&!t.ctrlKey){var r=a(t.currentTarget.href);if(e.currentLocation=a(window.location.href),e.currentLocation.host!==r.host)return;if(e.currentLocation.href!==r.href||e.currentLocation.hasHash&&!r.hasHash)return t.preventDefault(),void e.navigateTo(r.raw,t.currentTarget.dataset.transition||!1,t.currentTarget).catch(function(t){return console.warn(t)});e.currentLocation.hasHash||r.hasHash||t.preventDefault()}},this.onPopstate=function(){return!(window.location.pathname===e.currentLocation.pathname&&window.location.search===e.currentLocation.search&&!e.isPopping)&&(e.allowInterruption||!e.isTransitioning&&!e.isPopping?(e.isPopping||(e.popTarget=window.location.href),e.isPopping=!0,void e.navigateTo(window.location.href,!1,"popstate")):(window.history.pushState({},"",e.popTarget),console.warn(d),!1))},this.onPrefetch=function(t){var r=a(t.currentTarget.href);e.currentLocation.host===r.host&&e.preload(t.currentTarget.href,!1)};var r=t.links,n=void 0===r?"a[href]:not([target]):not([href^=\\#]):not([data-taxi-ignore])":r,i=t.removeOldContent,o=void 0===i||i,c=t.allowInterruption,s=void 0!==c&&c,h=t.bypassCache,f=void 0!==h&&h,p=t.enablePrefetch,v=void 0===p||p,g=t.renderers,m=t.transitions,w=void 0===m?{default:u}:m,y=t.reloadJsFilter,C=void 0===y?function(t){return void 0!==t.dataset.taxiReload}:y,T=t.reloadCssFilter,L=void 0===T?function(t){return!0}:T;this.renderers=void 0===g?{default:l}:g,this.transitions=w,this.defaultRenderer=this.renderers.default||l,this.defaultTransition=this.transitions.default||u,this.wrapper=document.querySelector("[data-taxi]"),this.reloadJsFilter=C,this.reloadCssFilter=L,this.removeOldContent=o,this.allowInterruption=s,this.bypassCache=f,this.enablePrefetch=v,this.cache=new Map,this.isPopping=!1,this.attachEvents(n),this.currentLocation=a(window.location.href),this.cache.set(this.currentLocation.href,this.createCacheEntry(document.cloneNode(!0),window.location.href)),this.currentCacheEntry=this.cache.get(this.currentLocation.href),this.currentCacheEntry.renderer.initialLoad()}var r=t.prototype;return r.setDefaultRenderer=function(t){this.defaultRenderer=this.renderers[t]},r.setDefaultTransition=function(t){this.defaultTransition=this.transitions[t]},r.addRoute=function(t,e,r){this.router||(this.router=new f),this.router.add(t,e,r)},r.preload=function(t,e){var r=this;return void 0===e&&(e=!1),t=a(t).href,this.cache.has(t)?Promise.resolve():this.fetch(t,!1).then(function(n){try{return r.cache.set(t,r.createCacheEntry(n.html,n.url)),e&&r.cache.get(t).renderer.createDom(),Promise.resolve()}catch(t){return Promise.reject(t)}}).catch(function(t){return console.warn(t)})},r.updateCache=function(t){var e=a(t||window.location.href).href;this.cache.has(e)&&this.cache.delete(e),this.cache.set(e,this.createCacheEntry(document.cloneNode(!0),e))},r.clearCache=function(t){var e=a(t||window.location.href).href;this.cache.has(e)&&this.cache.delete(e)},r.navigateTo=function(t,e,r){var n=this;return void 0===e&&(e=!1),void 0===r&&(r=!1),new Promise(function(i,o){if(n.allowInterruption||!n.isTransitioning){n.isTransitioning=!0,n.isPopping=!0,n.targetLocation=a(t),n.popTarget=window.location.href;var c,s=new(n.chooseTransition(e))({wrapper:n.wrapper});if(n.bypassCache||!n.cache.has(n.targetLocation.href)||n.cache.get(n.targetLocation.href).skipCache){var h=n.fetch(n.targetLocation.href).then(function(t){n.cache.set(n.targetLocation.href,n.createCacheEntry(t.html,t.url)),n.cache.get(n.targetLocation.href).renderer.createDom()}).catch(function(e){window.location.href=t});c=n.beforeFetch(n.targetLocation,s,r).then(function(){try{return Promise.resolve(h.then(function(){try{return Promise.resolve(n.afterFetch(n.targetLocation,s,n.cache.get(n.targetLocation.href),r))}catch(t){return Promise.reject(t)}}))}catch(t){return Promise.reject(t)}})}else n.cache.get(n.targetLocation.href).renderer.createDom(),c=n.beforeFetch(n.targetLocation,s,r).then(function(){try{return Promise.resolve(n.afterFetch(n.targetLocation,s,n.cache.get(n.targetLocation.href),r))}catch(t){return Promise.reject(t)}});c.then(function(){i()})}else o(new Error(d))})},r.on=function(t,r){e.default.on(t,r)},r.off=function(t,r){e.default.off(t,r)},r.beforeFetch=function(t,r,n){var i=this;return e.default.emit("NAVIGATE_OUT",{from:this.currentCacheEntry,trigger:n}),new Promise(function(e){i.currentCacheEntry.renderer.leave(r,n,i.removeOldContent).then(function(){"popstate"!==n&&window.history.pushState({},"",t.raw),e()})})},r.afterFetch=function(t,r,n,i){var o=this;return this.currentLocation=t,this.popTarget=this.currentLocation.href,new Promise(function(a){n.renderer.update(),e.default.emit("NAVIGATE_IN",{from:o.currentCacheEntry,to:n,trigger:i}),o.reloadJsFilter&&o.loadScripts(n.scripts),o.reloadCssFilter&&o.loadStyles(n.styles),"popstate"!==i&&t.href!==n.finalUrl&&window.history.replaceState({},"",n.finalUrl),n.renderer.enter(r,i).then(function(){e.default.emit("NAVIGATE_END",{from:o.currentCacheEntry,to:n,trigger:i}),o.currentCacheEntry=n,o.isTransitioning=!1,o.isPopping=!1,a()})})},r.loadScripts=function(t){for(var e=[].concat(t),r=Array.from(document.querySelectorAll("script")).filter(this.reloadJsFilter),n=0;n<r.length;n++)for(var o=0;o<e.length;o++)if(r[n].outerHTML===e[o].outerHTML){c(r[n],"SCRIPT"),e.splice(o,1);break}for(var a,h=i(e);!(a=h()).done;)s(a.value,"SCRIPT")},r.loadStyles=function(t){for(var e=Array.from(document.querySelectorAll('link[rel="stylesheet"]')).filter(this.reloadCssFilter),r=Array.from(document.querySelectorAll("style")).filter(this.reloadCssFilter),n=t.filter(function(t){return!t.href||(e.find(function(e){return e.href===t.href})?void 0:(document.body.append(t),!1))}),o=0;o<r.length;o++)for(var a=0;a<n.length;a++)if(r[o].outerHTML===n[a].outerHTML){c(r[o],"STYLE"),n.splice(a,1);break}for(var h,u=i(n);!(h=u()).done;)s(h.value,"STYLE")},r.attachEvents=function(t){e.default.delegate("click",t,this.onClick),e.default.on("popstate",window,this.onPopstate),this.enablePrefetch&&e.default.delegate("mouseenter focus",t,this.onPrefetch)},r.fetch=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t,e){var r=this;if(void 0===e&&(e=!0),this.activePromises.has(t))return this.activePromises.get(t);var n=new Promise(function(n,i){var a;fetch(t,{mode:"same-origin",method:"GET",headers:{"X-Requested-With":"Taxi"},credentials:"same-origin"}).then(function(r){return r.ok||(i("Taxi encountered a non 2xx HTTP status code"),e&&(window.location.href=t)),a=r.url,r.text()}).then(function(t){var e;n({html:(e=t,"string"==typeof e?o.parseFromString(e,"text/html"):e),url:a})}).catch(function(r){i(r),e&&(window.location.href=t)}).finally(function(){r.activePromises.delete(t)})});return this.activePromises.set(t,n),n}),r.chooseTransition=function(t){var e;if(t)return this.transitions[t];var r=null==(e=this.router)?void 0:e.findMatch(this.currentLocation,this.targetLocation);return r?this.transitions[r]:this.defaultTransition},r.createCacheEntry=function(t,e){var r=t.querySelector("[data-taxi-view]"),n=r.dataset.taxiView.length?this.renderers[r.dataset.taxiView]:this.defaultRenderer;return n||console.warn('The Renderer "'+r.dataset.taxiView+'" was set in the data-taxi-view of the requested page, but not registered in Taxi.'),{page:t,content:r,finalUrl:e,skipCache:r.hasAttribute("data-taxi-nocache"),scripts:this.reloadJsFilter?Array.from(t.querySelectorAll("script")).filter(this.reloadJsFilter):[],styles:this.reloadCssFilter?Array.from(t.querySelectorAll('link[rel="stylesheet"], style')).filter(this.reloadCssFilter):[],title:t.title,renderer:new n({wrapper:this.wrapper,title:t.title,content:r,page:t})}},t}();exports.Core=p,exports.Renderer=l,exports.Transition=u;
//# sourceMappingURL=taxi.js.map
