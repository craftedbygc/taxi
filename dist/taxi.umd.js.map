{"version":3,"file":"taxi.umd.js","sources":["../src/helpers.js","../src/Transition.js","../src/Renderer.js","../src/RouteStore.js","../src/Core.js"],"sourcesContent":["const parser = new DOMParser()\n\n/**\n * Parse a HTML string into a proper Document.\n *\n * @param {string|Document} html\n * @return {Document|*}\n */\nexport function parseDom(html) {\n\treturn typeof html === 'string' ? parser.parseFromString(html, 'text/html') : html\n}\n\n/**\n * Extract details from a given URL string. Assumed to be on the current TLD.\n *\n * @param {string} url\n * @return {{raw: string, href: string, host: string, search: string, hasHash: boolean, pathname: string}}\n */\nexport function processUrl(url) {\n\tconst details = new URL(url, window.location.origin)\n\tconst normalized = details.hash.length ? url.replace(details.hash, '') : null\n\n\treturn {\n\t\thasHash: details.hash.length > 0,\n\t\tpathname: details.pathname.replace(/\\/+$/, ''),\n\t\thost: details.host,\n\t\tsearch: details.search,\n\t\traw: url,\n\t\thref: normalized || details.href\n\t}\n}\n\n/**\n * Reloads a provided script/stylesheet by replacing with itself.\n *\n * @param {HTMLElement|HTMLScriptElement|HTMLStyleElement} node\n * @param {string} elementType - 'SCRIPT' or 'STYLE'\n */\nexport function reloadElement(node, elementType) {\n\tnode.parentNode.replaceChild(duplicateElement(node, elementType), node)\n}\n\n/**\n * Loads a provided script/stylesheet by appending a clone to the current document.\n *\n * @param {HTMLElement|HTMLStyleElement} node\n * @param {string} elementType - 'SCRIPT' or 'STYLE'\n */\nexport function appendElement(node, elementType) {\n\tconst target = node.parentNode.tagName === 'HEAD' ? document.head : document.body\n\ttarget.appendChild(duplicateElement(node, elementType))\n}\n\n/**\n * Creates a clone of a given HTMLElement or HTMLStyleElement\n *\n * @param {HTMLElement|HTMLStyleElement} node\n * @param {string} elementType - 'SCRIPT' or 'STYLE'\n * @return {HTMLElement|HTMLStyleElement}\n */\nexport function duplicateElement(node, elementType) {\n\tconst replacement = document.createElement(elementType)\n\n\tfor (let k = 0; k < node.attributes.length; k++) {\n\t\tconst attr = node.attributes[k]\n\t\treplacement.setAttribute(attr.nodeName, attr.nodeValue)\n\t}\n\n\t// Inline Script or Style\n\tif (node.innerHTML) {\n\t\treplacement.innerHTML = node.innerHTML\n\t}\n\n\treturn replacement\n}\n","export default class Transition {\n\t/**\n\t * @param {{wrapper: HTMLElement}} props\n\t */\n\tconstructor({ wrapper }) {\n\t\tthis.wrapper = wrapper\n\t}\n\n\t/**\n\t * @param {{ from: HTMLElement|Element, trigger: string|HTMLElement|false }} props\n\t * @return {Promise<void>}\n\t */\n\tleave(props) {\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.onLeave({ ...props, done: resolve })\n\t\t})\n\t}\n\n\t/**\n\t * @param {{ to: HTMLElement|Element, trigger: string|HTMLElement|false }} props\n\t * @return {Promise<void>}\n\t */\n\tenter(props) {\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.onEnter({ ...props, done: resolve })\n\t\t})\n\t}\n\n\t/**\n\t * Handle the transition leaving the previous page.\n\t * @param {{from: HTMLElement|Element, trigger: string|HTMLElement|false, done: function}} props\n\t */\n\tonLeave({ from, trigger, done }) {\n\t\tdone()\n\t}\n\n\t/**\n\t * Handle the transition entering the next page.\n\t * @param {{to: HTMLElement|Element, trigger: string|HTMLElement|false, done: function}} props\n\t */\n\tonEnter({ to, trigger, done }) {\n\t\tdone()\n\t}\n}\n","import Transition from \"./Transition\"\n\nexport default class Renderer {\n\t/**\n\t * @param {{content: HTMLElement|Element, page: Document|Node, title: string, wrapper: Element}} props\n\t */\n\tconstructor({ content, page, title, wrapper }) {\n\t\tthis._contentString = content.outerHTML\n\t\tthis._DOM = null\n\t\tthis.page = page\n\t\tthis.title = title\n\t\tthis.wrapper = wrapper\n\t\tthis.content = this.wrapper.lastElementChild\n\t}\n\n\tonEnter() {\n\n\t}\n\n\tonEnterCompleted() {\n\n\t}\n\n\tonLeave() {\n\n\t}\n\n\tonLeaveCompleted() {\n\n\t}\n\n\tinitialLoad() {\n\t\tthis.onEnter()\n\t\tthis.onEnterCompleted()\n\t}\n\n\tupdate() {\n\t\tdocument.title = this.title\n\t\tthis.wrapper.appendChild(this._DOM.firstElementChild)\n\t\tthis.content = this.wrapper.lastElementChild\n\t\tthis._DOM = null\n\t}\n\n\tcreateDom() {\n\t\tif (!this._DOM) {\n\t\t\tthis._DOM = document.createElement('div')\n\t\t\tthis._DOM.innerHTML = this._contentString\n\t\t}\n\t}\n\n\tremove() {\n\t\tthis.wrapper.firstElementChild.remove()\n\t}\n\n\t/**\n\t * Called when transitioning into the current page.\n\t * @param {Transition} transition\n\t * @param {string|HTMLElement|false} trigger\n\t * @return {Promise<null>}\n\t */\n\tenter(transition, trigger) {\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.onEnter()\n\n\t\t\ttransition.enter({ trigger, to: this.content })\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.onEnterCompleted()\n\t\t\t\t\tresolve()\n\t\t\t\t})\n\t\t})\n\t}\n\n\t/**\n\t * Called when transitioning away from the current page.\n\t * @param {Transition} transition\n\t * @param {string|HTMLElement|false} trigger\n\t * @param {boolean} removeOldContent\n\t * @return {Promise<null>}\n\t */\n\tleave(transition, trigger, removeOldContent) {\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.onLeave()\n\n\t\t\ttransition.leave({ trigger, from: this.content })\n\t\t\t\t.then(() => {\n\t\t\t\t\tif (removeOldContent) {\n\t\t\t\t\t\tthis.remove()\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.onLeaveCompleted()\n\t\t\t\t\tresolve()\n\t\t\t\t})\n\t\t})\n\t}\n}\n","export default class RouteStore {\n\t/**\n\t * @type {Map<string, Map<string, string>>}\n\t */\n\tdata = new Map()\n\n\t/**\n\t * @type {Map<string, RegExp>}\n\t */\n\tregexCache = new Map()\n\n\t/**\n\t *\n\t * @param {string} fromPattern\n\t * @param {string} toPattern\n\t * @param {string} transition\n\t */\n\tadd(fromPattern, toPattern, transition) {\n\t\tif (!this.data.has(fromPattern)) {\n\t\t\tthis.data.set(fromPattern, new Map())\n\t\t\tthis.regexCache.set(fromPattern, new RegExp(`^${fromPattern}$`))\n\t\t}\n\n\t\tthis.data.get(fromPattern).set(toPattern, transition)\n\t\tthis.regexCache.set(toPattern, new RegExp(`^${toPattern}$`))\n\t}\n\n\t/**\n\t *\n\t * @param {{ raw: string, href: string, hasHash: boolean, pathname: string }} currentUrl\n\t * @param {{ raw: string, href: string, hasHash: boolean, pathname: string }} nextUrl\n\t * @return {string|null}\n\t */\n\tfindMatch(currentUrl, nextUrl) {\n\t\t// Loop through all from patterns\n\t\tfor (const [fromPattern, potentialMatches] of this.data) {\n\t\t\t// If we have a match\n\t\t\tif (currentUrl.pathname.match(this.regexCache.get(fromPattern))) {\n\t\t\t\t// loop through all associated to patterns\n\t\t\t\tfor (const [toPattern, transition] of potentialMatches) {\n\t\t\t\t\t// If we find a match, return it\n\t\t\t\t\tif (nextUrl.pathname.match(this.regexCache.get(toPattern))) {\n\t\t\t\t\t\treturn transition\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\n\t\treturn null\n\t}\n}\n","import E from '@unseenco/e'\nimport { appendElement, parseDom, processUrl, reloadElement } from './helpers'\nimport Transition from './Transition'\nimport Renderer from './Renderer'\nimport RouteStore from './RouteStore'\n\nconst IN_PROGRESS = 'A transition is currently in progress'\n\n/**\n * @typedef CacheEntry\n * @type {object}\n * @property {typeof Renderer|Renderer} renderer\n * @property {Document|Node} page\n * @property {array} scripts\n * @property {HTMLLinkElement[]} styles\n * @property {string} finalUrl\n * @property {boolean} skipCache\n * @property {string} title\n * @property {HTMLElement|Element} content\n */\n\nexport default class Core {\n\tisTransitioning = false\n\n\t/**\n\t * @type {CacheEntry|null}\n\t */\n\tcurrentCacheEntry = null\n\n\t/**\n\t * @type {Map<string, CacheEntry>}\n\t */\n\tcache = new Map()\n\n\t/**\n\t * @private\n\t * @type {Map<string, Promise>}\n\t */\n\tactivePromises = new Map()\n\n\t/**\n\t * @param {{\n\t * \t\tlinks?: string,\n\t * \t\tremoveOldContent?: boolean,\n\t * \t\tallowInterruption?: boolean,\n\t * \t\tbypassCache?: boolean,\n\t * \t\tenablePrefetch?: boolean,\n\t * \t\trenderers?: Object.<string, typeof Renderer>,\n\t * \t\ttransitions?: Object.<string, typeof Transition>,\n\t * \t\treloadJsFilter?: boolean|function(HTMLElement): boolean,\n\t * \t\treloadCssFilter?: boolean|function(HTMLLinkElement): boolean\n\t * }} parameters\n\t */\n\tconstructor(parameters = {}) {\n\t\tconst {\n\t\t\tlinks = 'a[href]:not([target]):not([href^=\\\\#]):not([data-taxi-ignore])',\n\t\t\tremoveOldContent = true,\n\t\t\tallowInterruption = false,\n\t\t\tbypassCache = false,\n\t\t\tenablePrefetch = true,\n\t\t\trenderers = {\n\t\t\t\tdefault: Renderer\n\t\t\t},\n\t\t\ttransitions = {\n\t\t\t\tdefault: Transition\n\t\t\t},\n\t\t\treloadJsFilter = (element) => element.dataset.taxiReload !== undefined,\n\t\t\treloadCssFilter = (element) => true //element.dataset.taxiReload !== undefined\n\t\t} = parameters\n\n\t\tthis.renderers = renderers\n\t\tthis.transitions = transitions\n\t\tthis.defaultRenderer = this.renderers.default || Renderer\n\t\tthis.defaultTransition = this.transitions.default || Transition\n\t\tthis.wrapper = document.querySelector('[data-taxi]')\n\t\tthis.reloadJsFilter = reloadJsFilter\n\t\tthis.reloadCssFilter = reloadCssFilter\n\t\tthis.removeOldContent = removeOldContent\n\t\tthis.allowInterruption = allowInterruption\n\t\tthis.bypassCache = bypassCache\n\t\tthis.enablePrefetch = enablePrefetch\n\t\tthis.cache = new Map()\n\t\tthis.isPopping = false\n\n\t\t// Add delegated link events\n\t\tthis.attachEvents(links)\n\n\t\tthis.currentLocation = processUrl(window.location.href)\n\n\t\t// as this is the initial page load, prime this page into the cache\n\t\tthis.cache.set(this.currentLocation.href, this.createCacheEntry(document.cloneNode(true), window.location.href))\n\n\t\t// fire the current Renderer enter methods\n\t\tthis.currentCacheEntry = this.cache.get(this.currentLocation.href)\n\t\tthis.currentCacheEntry.renderer.initialLoad()\n\t}\n\n\t/**\n\t * @param {string} renderer\n\t */\n\tsetDefaultRenderer(renderer) {\n\t\tthis.defaultRenderer = this.renderers[renderer]\n\t}\n\n\t/**\n\t * @param {string} transition\n\t */\n\tsetDefaultTransition(transition) {\n\t\tthis.defaultTransition = this.transitions[transition]\n\t}\n\n\t/**\n\t * Registers a route into the RouteStore\n\t *\n\t * @param {string} fromPattern\n\t * @param {string} toPattern\n\t * @param {string} transition\n\t */\n\taddRoute(fromPattern, toPattern, transition) {\n\t\tif (!this.router) {\n\t\t\tthis.router = new RouteStore()\n\t\t}\n\n\t\tthis.router.add(fromPattern, toPattern, transition)\n\t}\n\n\t/**\n\t * Prime the cache for a given URL\n\t *\n\t * @param {string} url\n\t * @param {boolean} [preloadAssets]\n\t * @return {Promise}\n\t */\n\tpreload(url, preloadAssets = false) {\n\t\t// convert relative URLs to absolute\n\t\turl = processUrl(url).href\n\n\t\tif (!this.cache.has(url)) {\n\t\t\treturn this.fetch(url, false)\n\t\t\t\t.then(async (response) => {\n\t\t\t\t\tthis.cache.set(url, this.createCacheEntry(response.html, response.url))\n\n\t\t\t\t\tif (preloadAssets) {\n\t\t\t\t\t\tthis.cache.get(url).renderer.createDom()\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch(err => console.warn(err))\n\t\t}\n\n\t\treturn Promise.resolve()\n\t}\n\n\t/**\n\t * Updates the HTML cache for a given URL.\n\t * If no URL is passed, then cache for the current page is updated.\n\t * Useful when adding/removing content via AJAX such as a search page or infinite loader.\n\t *\n\t * @param {string} [url]\n\t */\n\tupdateCache(url) {\n\t\tconst key = processUrl(url || window.location.href).href\n\n\t\tif (this.cache.has(key)) {\n\t\t\tthis.cache.delete(key)\n\t\t}\n\n\t\tthis.cache.set(key, this.createCacheEntry(document.cloneNode(true), key))\n\t}\n\n\t/**\n\t * Clears the cache for a given URL.\n\t * If no URL is passed, then cache for the current page is cleared.\n\t *\n\t * @param {string} [url]\n\t */\n\tclearCache(url) {\n\t\tconst key = processUrl(url || window.location.href).href\n\n\t\tif (this.cache.has(key)) {\n\t\t\tthis.cache.delete(key)\n\t\t}\n\t}\n\n\t/**\n\t * @param {string} url\n\t * @param {string|false} [transition]\n\t * @param {string|false|HTMLElement} [trigger]\n\t * @return {Promise<void|Error>}\n\t */\n\tnavigateTo(url, transition = false, trigger = false) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\t// Don't allow multiple navigations to occur at once\n\t\t\tif (!this.allowInterruption && this.isTransitioning) {\n\t\t\t\treject(new Error(IN_PROGRESS))\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tthis.isTransitioning = true\n\t\t\tthis.isPopping = true\n\t\t\tthis.targetLocation = processUrl(url)\n\t\t\tthis.popTarget = window.location.href\n\n\t\t\tconst TransitionClass = new (this.chooseTransition(transition))({ wrapper: this.wrapper })\n\n\t\t\tlet navigationPromise\n\n\t\t\tif (this.bypassCache || !this.cache.has(this.targetLocation.href) || this.cache.get(this.targetLocation.href).skipCache) {\n\t\t\t\tconst fetched = this.fetch(this.targetLocation.href)\n\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\tthis.cache.set(this.targetLocation.href, this.createCacheEntry(response.html, response.url))\n\t\t\t\t\t\tthis.cache.get(this.targetLocation.href).renderer.createDom()\n\t\t\t\t\t})\n\t\t\t\t\t.catch(err => {\n\t\t\t\t\t\t// we encountered a 4** or 5** error, redirect to the requested URL\n\t\t\t\t\t\twindow.location.href = url\n\t\t\t\t\t})\n\n\t\t\t\tnavigationPromise = this.beforeFetch(this.targetLocation, TransitionClass, trigger)\n\t\t\t\t\t.then(async () => {\n\t\t\t\t\t\treturn fetched.then(async () => {\n\t\t\t\t\t\t\treturn await this.afterFetch(this.targetLocation, TransitionClass, this.cache.get(this.targetLocation.href), trigger)\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tthis.cache.get(this.targetLocation.href).renderer.createDom()\n\n\t\t\t\tnavigationPromise = this.beforeFetch(this.targetLocation, TransitionClass, trigger)\n\t\t\t\t\t.then(async () => {\n\t\t\t\t\t\treturn await this.afterFetch(this.targetLocation, TransitionClass, this.cache.get(this.targetLocation.href), trigger)\n\t\t\t\t\t})\n\t\t\t}\n\n\t\t\tnavigationPromise.then(() => {\n\t\t\t\tresolve()\n\t\t\t})\n\t\t})\n\t}\n\n\t/**\n\t * Add an event listener.\n\t * @param {string} event\n\t * @param {any} callback\n\t */\n\ton(event, callback) {\n\t\tE.on(event, callback)\n\t}\n\n\t/**\n\t * Remove an event listener.\n\t * @param {string} event\n\t * @param {any} [callback]\n\t */\n\toff(event, callback) {\n\t\tE.off(event, callback)\n\t}\n\n\t/**\n\t * @private\n\t * @param {{ raw: string, href: string, hasHash: boolean, pathname: string }} url\n\t * @param {Transition} TransitionClass\n\t * @param {string|HTMLElement|false} trigger\n\t * @return {Promise<void>}\n\t */\n\tbeforeFetch(url, TransitionClass, trigger) {\n\t\tE.emit('NAVIGATE_OUT', {\n\t\t\tfrom: this.currentCacheEntry,\n\t\t\ttrigger\n\t\t})\n\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.currentCacheEntry.renderer.leave(TransitionClass, trigger, this.removeOldContent)\n\t\t\t\t.then(() => {\n\t\t\t\t\tif (trigger !== 'popstate') {\n\t\t\t\t\t\twindow.history.pushState({}, '', url.raw)\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve()\n\t\t\t\t})\n\t\t})\n\t}\n\n\t/**\n\t * @private\n\t * @param {{ raw: string, href: string, host: string, hasHash: boolean, pathname: string }} url\n\t * @param {Transition} TransitionClass\n\t * @param {CacheEntry} entry\n\t * @param {string|HTMLElement|false} trigger\n\t * @return {Promise<void>}\n\t */\n\tafterFetch(url, TransitionClass, entry, trigger) {\n\t\tthis.currentLocation = url\n\t\tthis.popTarget = this.currentLocation.href\n\n\t\treturn new Promise((resolve) => {\n\t\t\tentry.renderer.update()\n\n\t\t\tE.emit('NAVIGATE_IN', {\n\t\t\t\tfrom: this.currentCacheEntry,\n\t\t\t\tto: entry,\n\t\t\t\ttrigger\n\t\t\t})\n\n\t\t\tif (this.reloadJsFilter) {\n\t\t\t\tthis.loadScripts(entry.scripts)\n\t\t\t}\n\n\t\t\tif (this.reloadCssFilter) {\n\t\t\t\tthis.loadStyles(entry.styles)\n\t\t\t}\n\n\t\t\t// If the fetched url had a redirect chain, then replace the history to reflect the final resolved URL\n\t\t\tif (trigger !== 'popstate' && url.href !== entry.finalUrl) {\n\t\t\t\twindow.history.replaceState({}, '', entry.finalUrl)\n\t\t\t}\n\n\t\t\tentry.renderer.enter(TransitionClass, trigger)\n\t\t\t\t.then(() => {\n\t\t\t\t\tE.emit('NAVIGATE_END', {\n\t\t\t\t\t\tfrom: this.currentCacheEntry,\n\t\t\t\t\t\tto: entry,\n\t\t\t\t\t\ttrigger\n\t\t\t\t\t})\n\n\t\t\t\t\tthis.currentCacheEntry = entry\n\t\t\t\t\tthis.isTransitioning = false\n\t\t\t\t\tthis.isPopping = false\n\t\t\t\t\tresolve()\n\t\t\t\t})\n\t\t})\n\t}\n\n\t/**\n\t * Load up scripts from the target page if needed\n\t *\n\t * @param {HTMLElement[]} cachedScripts\n\t */\n\tloadScripts(cachedScripts) {\n\t\tconst newScripts = [...cachedScripts]\n\t\tconst currentScripts = Array.from(document.querySelectorAll('script')).filter(this.reloadJsFilter)\n\n\t\t// loop through all new scripts\n\t\tfor (let i = 0; i < currentScripts.length; i++) {\n\t\t\tfor (let n = 0; n < newScripts.length; n++) {\n\t\t\t\tif (currentScripts[i].outerHTML === newScripts[n].outerHTML) {\n\t\t\t\t\treloadElement(currentScripts[i], 'SCRIPT')\n\t\t\t\t\tnewScripts.splice(n, 1)\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (const script of newScripts) {\n\t\t\tappendElement(script, 'SCRIPT')\n\t\t}\n\t}\n\n\t/**\n\t * Load up styles from the target page if needed\n\t *\n\t * @param {Array<HTMLLinkElement|HTMLStyleElement>} cachedStyles\n\t */\n\tloadStyles(cachedStyles) {\n\t\tconst currentStyles = Array.from(document.querySelectorAll('link[rel=\"stylesheet\"]')).filter(this.reloadCssFilter)\n\t\tconst currentInlineStyles = Array.from(document.querySelectorAll('style')).filter(this.reloadCssFilter)\n\n\t\tconst newInlineStyles = cachedStyles.filter(el => {\n\t\t\t// no el.href, assume it's an inline style\n\t\t\tif (!el.href) {\n\t\t\t\treturn true\n\t\t\t} else if (!currentStyles.find((link) => link.href === el.href)) {\n\t\t\t\tdocument.body.append(el)\n\t\t\t\treturn false\n\t\t\t}\n\t\t})\n\n\t\t// loop through all new inline styles\n\t\tfor (let i = 0; i < currentInlineStyles.length; i++) {\n\t\t\tfor (let n = 0; n < newInlineStyles.length; n++) {\n\t\t\t\tif (currentInlineStyles[i].outerHTML === newInlineStyles[n].outerHTML) {\n\t\t\t\t\treloadElement(currentInlineStyles[i], 'STYLE')\n\t\t\t\t\tnewInlineStyles.splice(n, 1)\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (const style of newInlineStyles) {\n\t\t\tappendElement(style, 'STYLE')\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t * @param {string} links\n\t */\n\tattachEvents(links) {\n\t\tE.delegate('click', links, this.onClick)\n\t\tE.on('popstate', window, this.onPopstate)\n\n\t\tif (this.enablePrefetch) {\n\t\t\tE.delegate('mouseenter focus', links, this.onPrefetch)\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t * @param {MouseEvent} e\n\t */\n\tonClick = (e) => {\n\t\tif (!(e.metaKey || e.ctrlKey)) {\n\t\t\tconst target = processUrl(e.currentTarget.href)\n\t\t\tthis.currentLocation = processUrl(window.location.href)\n\n\t\t\tif (this.currentLocation.host !== target.host) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t// the target is a new URL, or is removing the hash from the current URL\n\t\t\tif (this.currentLocation.href !== target.href || (this.currentLocation.hasHash && !target.hasHash)) {\n\t\t\t\te.preventDefault()\n\t\t\t\t// noinspection JSIgnoredPromiseFromCall\n\t\t\t\tthis.navigateTo(target.raw, e.currentTarget.dataset.transition || false, e.currentTarget).catch(err => console.warn(err))\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t// a click to the current URL was detected\n\t\t\tif (!this.currentLocation.hasHash && !target.hasHash) {\n\t\t\t\te.preventDefault()\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t * @return {void|boolean}\n\t */\n\tonPopstate = () => {\n\t\tconst target = processUrl(window.location.href)\n\n\t\t// don't trigger for on-page anchors\n\t\tif (\n\t\t\ttarget.pathname === this.currentLocation.pathname\n\t\t\t&& target.search === this.currentLocation.search\n\t\t\t&& !this.isPopping\n\t\t) {\n\t\t\treturn false\n\t\t}\n\n\t\tif (!this.allowInterruption && (this.isTransitioning || this.isPopping)) {\n\t\t\t// overwrite history state with current page if currently navigating\n\t\t\twindow.history.pushState({}, '', this.popTarget)\n\t\t\tconsole.warn(IN_PROGRESS)\n\t\t\treturn false\n\t\t}\n\n\t\tif (!this.isPopping) {\n\t\t\tthis.popTarget = window.location.href\n\t\t}\n\n\t\tthis.isPopping = true\n\n\t\t// noinspection JSIgnoredPromiseFromCall\n\t\tthis.navigateTo(window.location.href, false, 'popstate')\n\t}\n\n\t/**\n\t * @private\n\t * @param {MouseEvent} e\n\t */\n\tonPrefetch = (e) => {\n\t\tconst target = processUrl(e.currentTarget.href)\n\n\t\tif (this.currentLocation.host !== target.host) {\n\t\t\treturn\n\t\t}\n\n\t\tthis.preload(e.currentTarget.href, false)\n\t}\n\n\t/**\n\t * @private\n\t * @param {string} url\n\t * @param {boolean} [runFallback]\n\t * @return {Promise<{html: Document, url: string}>}\n\t */\n\tfetch(url, runFallback = true) {\n\t\t// If Taxi is currently performing a fetch for the given URL, return that instead of starting a new request\n\t\tif (this.activePromises.has(url)) {\n\t\t\treturn this.activePromises.get(url)\n\t\t}\n\n\t\tconst request = new Promise((resolve, reject) => {\n\t\t\tlet resolvedUrl\n\n\t\t\tfetch(url, {\n\t\t\t\tmode: 'same-origin',\n\t\t\t\tmethod: 'GET',\n\t\t\t\theaders: { 'X-Requested-With': 'Taxi' },\n\t\t\t\tcredentials: 'same-origin'\n\t\t\t})\n\t\t\t\t.then((response) => {\n\t\t\t\t\tif (!response.ok) {\n\t\t\t\t\t\treject('Taxi encountered a non 2xx HTTP status code')\n\n\t\t\t\t\t\tif (runFallback) {\n\t\t\t\t\t\t\twindow.location.href = url\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tresolvedUrl = response.url\n\n\t\t\t\t\treturn response.text()\n\t\t\t\t})\n\t\t\t\t.then((htmlString) => {\n\t\t\t\t\tresolve({ html: parseDom(htmlString), url: resolvedUrl })\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\treject(err)\n\n\t\t\t\t\tif (runFallback) {\n\t\t\t\t\t\twindow.location.href = url\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.finally(() => {\n\t\t\t\t\tthis.activePromises.delete(url)\n\t\t\t\t})\n\t\t})\n\n\t\tthis.activePromises.set(url, request)\n\n\t\treturn request\n\t}\n\n\t/**\n\t * @private\n\t * @param {string|false} transition\n\t * @return {Transition|function}\n\t */\n\tchooseTransition(transition) {\n\t\tif (transition) {\n\t\t\treturn this.transitions[transition]\n\t\t}\n\n\t\tconst routeTransition = this.router?.findMatch(this.currentLocation, this.targetLocation)\n\n\t\tif (routeTransition) {\n\t\t\treturn this.transitions[routeTransition]\n\t\t}\n\n\t\treturn this.defaultTransition\n\t}\n\n\t/**\n\t * @private\n\t * @param {Document|Node} page\n\t * @param {string} url\n\t * @return {CacheEntry}\n\t */\n\tcreateCacheEntry(page, url) {\n\t\tconst content = page.querySelector('[data-taxi-view]')\n\t\tconst Renderer = content.dataset.taxiView.length ? this.renderers[content.dataset.taxiView] : this.defaultRenderer\n\n\t\tif (!Renderer) {\n\t\t\tconsole.warn(`The Renderer \"${content.dataset.taxiView}\" was set in the data-taxi-view of the requested page, but not registered in Taxi.`)\n\t\t}\n\n\t\treturn {\n\t\t\tpage,\n\t\t\tcontent,\n\t\t\tfinalUrl: url,\n\t\t\tskipCache: content.hasAttribute('data-taxi-nocache'),\n\t\t\tscripts: this.reloadJsFilter ? Array.from(page.querySelectorAll('script')).filter(this.reloadJsFilter) : [],\n\t\t\tstyles: this.reloadCssFilter ? Array.from(page.querySelectorAll('link[rel=\"stylesheet\"], style')).filter(this.reloadCssFilter) : [],\n\t\t\ttitle: page.title,\n\t\t\trenderer: new Renderer({\n\t\t\t\twrapper: this.wrapper,\n\t\t\t\ttitle: page.title,\n\t\t\t\tcontent,\n\t\t\t\tpage\n\t\t\t})\n\t\t}\n\t}\n}\n"],"names":["parser","DOMParser","processUrl","url","details","URL","window","location","origin","normalized","hash","length","replace","hasHash","pathname","host","search","raw","href","reloadElement","node","elementType","parentNode","replaceChild","duplicateElement","appendElement","tagName","document","head","body","appendChild","replacement","createElement","k","attributes","attr","setAttribute","nodeName","nodeValue","innerHTML","Transition","this","wrapper","leave","props","Promise","resolve","_this","onLeave","done","enter","_this2","onEnter","Renderer","page","title","_contentString","content","outerHTML","_DOM","lastElementChild","onEnterCompleted","onLeaveCompleted","initialLoad","update","firstElementChild","createDom","remove","transition","trigger","to","then","removeOldContent","from","RouteStore","data","Map","regexCache","add","fromPattern","toPattern","has","set","RegExp","get","findMatch","currentUrl","nextUrl","potentialMatches","match","IN_PROGRESS","Core","parameters","isTransitioning","currentCacheEntry","cache","activePromises","onClick","e","metaKey","ctrlKey","target","currentTarget","currentLocation","preventDefault","navigateTo","dataset","err","console","warn","onPopstate","isPopping","allowInterruption","popTarget","history","pushState","onPrefetch","preload","links","bypassCache","enablePrefetch","renderers","transitions","default","reloadJsFilter","element","undefined","taxiReload","reloadCssFilter","defaultRenderer","defaultTransition","querySelector","attachEvents","createCacheEntry","cloneNode","renderer","setDefaultRenderer","setDefaultTransition","addRoute","router","preloadAssets","fetch","response","html","updateCache","key","clearCache","reject","_this3","targetLocation","navigationPromise","TransitionClass","chooseTransition","skipCache","fetched","beforeFetch","afterFetch","Error","on","event","callback","E","off","emit","_this4","entry","_this5","loadScripts","scripts","loadStyles","styles","finalUrl","replaceState","cachedScripts","newScripts","currentScripts","Array","querySelectorAll","filter","i","n","splice","cachedStyles","currentStyles","currentInlineStyles","newInlineStyles","el","find","link","append","delegate","runFallback","request","resolvedUrl","mode","method","headers","credentials","ok","text","htmlString","parseFromString","_this6","routeTransition","_this$router","taxiView","hasAttribute"],"mappings":"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"}